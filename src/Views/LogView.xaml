<base:LecgWindow x:Class="LECG.Views.LogView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:base="clr-namespace:LECG.Views.Base"
    xmlns:utils="clr-namespace:LECG.Utils"
    xmlns:icons="clr-namespace:LECG.Utils"
    xmlns:vm="clr-namespace:LECG.ViewModels"
    xmlns:logging="clr-namespace:LECG.Services.Logging" mc:Ignorable="d" Title="{Binding Title}" Height="450" Width="600" MinHeight="320" MaxHeight="800" WindowIcon="{x:Static icons:Icons.Layers}" WindowStartupLocation="CenterScreen" d:DataContext="{d:DesignInstance Type=vm:LogViewModel}">

    <base:LecgWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/LECG;component/src/Resources/Styles.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- Converters if needed -->

            <!-- Log Item Template -->
            <DataTemplate DataType="{x:Type logging:LogEntry}">
                <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1" Padding="8,4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="Time"/>
                            <ColumnDefinition Width="Auto" SharedSizeGroup="Level"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Time -->
                        <TextBlock Text="{Binding FormattedTime}" Foreground="{DynamicResource TextMutedBrush}" FontSize="11" Margin="0,0,12,0" VerticalAlignment="Center" FontFamily="Consolas, Monospace"/>

                        <!-- Level Indicator -->
                        <Border Grid.Column="1" CornerRadius="4" Margin="0,0,12,0" Padding="6,2" VerticalAlignment="Center" MinWidth="60">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="#EDF2F7"/>
                                    <!-- Default Gray -->
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Level}" Value="Success">
                                            <Setter Property="Background" Value="#C6F6D5"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Level}" Value="Warning">
                                            <Setter Property="Background" Value="#FEEBC8"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding Level}" Value="Error">
                                            <Setter Property="Background" Value="#FED7D7"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <TextBlock Text="{Binding Level}" HorizontalAlignment="Center" FontWeight="SemiBold" FontSize="10">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Level}" Value="Success">
                                                <Setter Property="Foreground" Value="#22543D"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Level}" Value="Warning">
                                                <Setter Property="Foreground" Value="#744210"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Level}" Value="Error">
                                                <Setter Property="Foreground" Value="#822727"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Border>

                        <!-- Message -->
                        <TextBlock Grid.Column="2" Text="{Binding Message}" TextWrapping="Wrap" Foreground="{DynamicResource TextPrimaryBrush}" FontSize="12" VerticalAlignment="Center"/>
                    </Grid>
                </Border>
            </DataTemplate>
        </ResourceDictionary>
    </base:LecgWindow.Resources>

    <Grid Margin="{DynamicResource ViewContentMargin}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header Status -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="{Binding CurrentStatus}" FontSize="{DynamicResource FontSizeBody}" FontWeight="{DynamicResource WeightBold}" Foreground="{DynamicResource TextPrimaryBrush}" Margin="0,0,0,8"/>

            <!-- Minimal Progress Bar -->
            <Grid Height="4">
                <Border CornerRadius="2" Background="{DynamicResource ContentBackgroundBrush}"/>
                <Border CornerRadius="2" Background="{DynamicResource PrimaryAccentBrush}" HorizontalAlignment="Left">
                    <Border.Width>
                        <MultiBinding Converter="{utils:MathConverter}" ConverterParameter="x/100*y">
                            <Binding Path="ProgressValue"/>
                            <Binding Path="ActualWidth" RelativeSource="{RelativeSource AncestorType=Grid}"/>
                        </MultiBinding>
                    </Border.Width>
                </Border>
            </Grid>
        </StackPanel>

        <!-- Log List -->
        <Border Grid.Row="1" CornerRadius="{DynamicResource ContentCornerRadius}" Background="{DynamicResource LogBackgroundBrush}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
            <ListView ItemsSource="{Binding Entries}" BorderThickness="0" Background="Transparent" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListViewItem">
                                    <ContentPresenter/>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
        </Border>

        <!-- Actions -->
        <Grid Grid.Row="2" Margin="0,12,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Command="{Binding CopyCommand}" Content="Copy Log" Style="{DynamicResource SecondaryButtonStyle}" Height="32" Padding="12,0"/>
            <Button Grid.Column="2" Click="Close_Click" Content="Close" Style="{DynamicResource PrimaryButtonStyle}" Height="32" MinWidth="80"/>
        </Grid>
    </Grid>
</base:LecgWindow>
